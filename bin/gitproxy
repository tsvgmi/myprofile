#!/bin/env bash
. ${0%/*}/../etc/tool.env
######################################################################
# File: 	shtool
# Description:  Simple addition to support using using shell
# Author:	Thien Vuong
#######################################################################

function f_setProxy {
  user=$1
  typeset passwd

  [ "$user" ] || user=$USER
  if [ ! "$GIT_PROXY" ]; then
    passwd=$(F_passwdGet)
    export GIT_SSL_NO_VERIFY=true
    export EGIT_PROXY=http://$user:$passwd@10.55.79.200:9090/
    export http_proxy=$EGIT_PROXY
    export https_proxy=$EGIT_PROXY
  fi
}

#---------------------------------------------------- Begin of script ---
#---------------------------------------------------- Begin of script ---
#---------------------------------------------------- Begin of script ---
F_subCommand $*
oper=$1; shift

case $oper in
  clone|push)
    f_setProxy $USER
    git $oper $@
    ;;

  svn)
    f_setProxy $USER
    svn $@
    ;;

  *)                                                                   #{{{2
    F_usageOper $oper
    ;;
esac
exit 0                                                                 #{{{1

=begin
=NAME
gitproxy - Front end for proxy access of SCM

=SYNOPSIS
  * gitproxy clone:push
  * gitproxy svn

=DESCRIPTION

=end
