#!/bin/bash
file="$@"

[ -d ~/.gvsessions ] || mkdir -p ~/.gvsessions
ckfile=~/.gvsession.dat

lname=$(head -1 "$file" | \
        sed -e 's/^h[0-9]\. *//' -e 's/[^A-Za-z0-9]/_/g' \
            -e 's/_+/_/g' | tee $ckfile)

if [ "$lname" ]; then
  lfile=~/.gvsessions/$lname

  if [ -L "$lfile" ]; then
    rm -f "$lfile"
  fi
  ln -s "$file" "$lfile"
  echo $lfile >$ckfile
  exec ~/bin/mvim --remote "$lfile"
else
  exec ~/bin/mvim --remote "$file"
fi
